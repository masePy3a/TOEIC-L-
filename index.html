<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TOEIC RTLT: æ©Ÿèƒ½è¡¨ç¾ã‚¯ã‚¤ã‚ºï¼ˆéŸ³å£°æ©Ÿèƒ½ä»˜ãï¼‰</title>
<style>
/* ã‚¹ãƒãƒ›å‘ã‘ã«ä½¿ã„ã‚„ã™ã„ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‡ã‚¶ã‚¤ãƒ³ */
body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
margin: 0;
padding: 20px;
background-color: #f4f7f6;
color: #333;
}
.container {
max-width: 700px;
margin: 0 auto;
}
.tab-buttons {
display: flex;
gap: 10px;
margin-bottom: 20px;
flex-wrap: wrap;
}
.tab-buttons button {
padding: 10px 20px;
border: 2px solid #ccc;
border-radius: 8px;
background-color: #fff;
cursor: pointer;
font-size: 1em;
transition: background-color 0.3s;
}
.tab-buttons button.active {
background-color: #007bff;
color: white;
border-color: #007bff;
}
.tab-content {
display: none;
}
.tab-content.active {
display: block;
}
.quiz-container {
background-color: #ffffff;
padding: 20px;
border-radius: 12px;
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}
.question-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 15px;
gap: 10px;
}
.question-text {
font-size: 1.1em;
margin-bottom: 25px;
padding: 15px;
border-left: 5px solid #007bff;
background-color: #e9f0ff;
flex: 1;
}
.voice-button {
background-color: #28a745;
color: white;
border: none;
border-radius: 8px;
padding: 10px 15px;
cursor: pointer;
font-size: 1em;
transition: background-color 0.3s;
display: flex;
align-items: center;
gap: 5px;
white-space: nowrap;
}
.voice-button:hover {
background-color: #218838;
}
.voice-button:disabled {
background-color: #6c757d;
cursor: not-allowed;
}
.voice-button.playing {
background-color: #ff6b6b;
}
.options {
margin-bottom: 15px;
}
.option-item {
display: flex;
gap: 10px;
margin-bottom: 10px;
align-items: center;
}
.option-item button {
flex: 1;
padding: 15px;
border: 2px solid #ccc;
border-radius: 8px;
background-color: #fff;
font-size: 1em;
cursor: pointer;
transition: background-color 0.3s, border-color 0.3s;
text-align: left;
}
.option-item button:hover:not(:disabled) {
background-color: #f0f0f0;
}
.option-item .voice-button-small {
padding: 8px 12px;
font-size: 0.9em;
min-width: 50px;
justify-content: center;
}
.feedback {
margin-top: 20px;
padding: 10px;
border-radius: 8px;
font-weight: bold;
display: none;
}
.correct {
background-color: #d4edda;
color: #155724;
}
.incorrect {
background-color: #f8d7da;
color: #721c24;
}
.next-button {
display: none;
width: 100%;
padding: 15px;
background-color: #28a745;
color: white;
border: none;
border-radius: 8px;
font-size: 1.1em;
cursor: pointer;
margin-top: 20px;
}
/* ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.form-group {
margin-bottom: 20px;
}
.form-group label {
display: block;
font-weight: bold;
margin-bottom: 8px;
color: #333;
}
.form-group input,
.form-group textarea {
width: 100%;
padding: 10px;
border: 1px solid #ccc;
border-radius: 8px;
font-size: 1em;
box-sizing: border-box;
font-family: inherit;
}
.form-group textarea {
resize: vertical;
min-height: 80px;
}
.option-group {
display: flex;
gap: 10px;
margin-bottom: 10px;
align-items: center;
}
.option-group input {
flex: 1;
}
.option-group label {
margin: 0;
display: flex;
align-items: center;
gap: 5px;
}
.option-group input[type="radio"] {
width: auto;
margin: 0;
}
.button-group {
display: flex;
gap: 10px;
}
.button-group button {
flex: 1;
padding: 12px;
border: none;
border-radius: 8px;
font-size: 1em;
cursor: pointer;
}
.btn-primary {
background-color: #007bff;
color: white;
}
.btn-primary:hover {
background-color: #0056b3;
}
.btn-danger {
background-color: #dc3545;
color: white;
}
.btn-danger:hover {
background-color: #a02830;
}
.btn-secondary {
background-color: #6c757d;
color: white;
}
.btn-secondary:hover {
background-color: #545b62;
}
.question-item {
background-color: #f9f9f9;
padding: 15px;
border-radius: 8px;
margin-bottom: 15px;
border-left: 4px solid #007bff;
}
.question-item-text {
font-weight: bold;
margin-bottom: 10px;
}
.question-item-options {
margin-bottom: 10px;
font-size: 0.95em;
color: #555;
}
.question-item-actions {
display: flex;
gap: 10px;
}
.question-item-actions button {
flex: 1;
padding: 8px;
border: none;
border-radius: 6px;
cursor: pointer;
font-size: 0.9em;
}
.btn-edit {
background-color: #17a2b8;
color: white;
}
.btn-edit:hover {
background-color: #138496;
}
.btn-delete {
background-color: #dc3545;
color: white;
}
.btn-delete:hover {
background-color: #a02830;
}
.success-message {
background-color: #d4edda;
color: #155724;
padding: 10px;
border-radius: 8px;
margin-bottom: 15px;
display: none;
}
.error-message {
background-color: #f8d7da;
color: #721c24;
padding: 10px;
border-radius: 8px;
margin-bottom: 15px;
display: none;
}
.voice-settings {
background-color: #f9f9f9;
padding: 15px;
border-radius: 8px;
margin-bottom: 15px;
}
.voice-settings label {
display: block;
margin-bottom: 10px;
font-weight: bold;
}
.voice-settings select {
width: 100%;
padding: 8px;
border: 1px solid #ccc;
border-radius: 4px;
}
</style>
<!-- quiz-data.js ã‚’èª­ã¿è¾¼ã¿ï¼ˆå¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å•é¡Œãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼‰ -->
<script src="quiz-data.js"></script>
</head>
<body>

<div class="container">
<h1>ğŸ¤ TOEIC L495 ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆéŸ³å£°æ©Ÿèƒ½ä»˜ãï¼‰</h1>

<!-- ã‚¿ãƒ–ãƒœã‚¿ãƒ³ -->
<div class="tab-buttons">
<button class="tab-btn active" onclick="switchTab('quiz')">ã‚¯ã‚¤ã‚º</button>
<button class="tab-btn" onclick="switchTab('edit')">å•é¡Œã®ç®¡ç†</button>
<button class="tab-btn" onclick="switchTab('voice-settings')">éŸ³å£°è¨­å®š</button>
<button class="tab-btn" onclick="switchTab('settings')">ãƒ‡ãƒ¼ã‚¿</button>
</div>

<!-- ã‚¯ã‚¤ã‚ºã‚¿ãƒ– -->
<div class="tab-content active" id="quiz">
<div class="quiz-container">
<div class="question-header">
<div class="question-text" id="question-text">ã‚¯ã‚¤ã‚ºãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
<button class="voice-button" id="question-voice-btn" onclick="speakQuestion()" title="å•é¡Œã‚’èª­ã¿ä¸Šã’ã¾ã™">
ğŸ”Š
</button>
<button class="voice-button" id="hint-btn" onclick="showHint()" title="ãƒ’ãƒ³ãƒˆã‚’è¡¨ç¤ºã—ã¾ã™" style="background-color: #ffc107; color: black;">
ğŸ’¡ ãƒ’ãƒ³ãƒˆ
</button>
</div>

<div id="hint-box" style="display: none; background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 12px; margin-bottom: 20px; border-radius: 4px; color: #856404;">
<strong>ãƒ’ãƒ³ãƒˆ:</strong> <span id="hint-text"></span>
</div>

<!-- ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒæ©Ÿèƒ½ -->
<div id="stopwatch-container" style="background-color: #e8f4f8; border: 2px solid #007bff; padding: 15px; margin-bottom: 20px; border-radius: 8px; text-align: center;">
<div style="font-size: 2em; font-weight: bold; color: #007bff; margin-bottom: 10px;">
â±ï¸ <span id="stopwatch-time">00:00</span>
</div>
<div style="font-size: 0.9em; color: #555; margin-bottom: 10px;">
ç›®æ¨™æ™‚é–“: <span id="target-time">1:35</span> (1å•ã‚ãŸã‚Šç´„1åˆ†35ç§’) | çµŒé: <span id="elapsed-questions">0</span>/<span id="total-questions">28</span>
</div>
<div style="width: 100%; background-color: #ddd; height: 8px; border-radius: 4px; margin-bottom: 10px; overflow: hidden;">
<div id="progress-bar" style="width: 0%; height: 100%; background-color: #28a745; transition: width 0.3s;"></div>
</div>
<div style="display: flex; gap: 8px; justify-content: center;">
<button onclick="toggleStopwatch()" id="stopwatch-btn" style="padding: 8px 16px; background-color: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9em;">
â–¶ï¸ é–‹å§‹
</button>
<button onclick="resetStopwatch()" style="padding: 8px 16px; background-color: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9em;">
ğŸ”„ ãƒªã‚»ãƒƒãƒˆ
</button>
</div>
</div>

<div class="options" id="options">
<div class="option-item">
<button onclick="checkAnswer(0)">é¸æŠè‚¢ A</button>
<button class="voice-button voice-button-small" onclick="speakOption(0)" title="é¸æŠè‚¢ã‚’èª­ã¿ä¸Šã’ã¾ã™">ğŸ”Š</button>
</div>
<div class="option-item">
<button onclick="checkAnswer(1)">é¸æŠè‚¢ B</button>
<button class="voice-button voice-button-small" onclick="speakOption(1)" title="é¸æŠè‚¢ã‚’èª­ã¿ä¸Šã’ã¾ã™">ğŸ”Š</button>
</div>
<div class="option-item">
<button onclick="checkAnswer(2)">é¸æŠè‚¢ C</button>
<button class="voice-button voice-button-small" onclick="speakOption(2)" title="é¸æŠè‚¢ã‚’èª­ã¿ä¸Šã’ã¾ã™">ğŸ”Š</button>
</div>
</div>

<div class="feedback" id="feedback">ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</div>

<button class="next-button" id="next-button" onclick="loadNextQuestion()">æ¬¡ã®å•é¡Œã¸ (1/5)</button>
</div>
</div>

<!-- ç·¨é›†ã‚¿ãƒ– -->
<div class="tab-content" id="edit">
<div class="quiz-container">
<h2>å•é¡Œã®ç®¡ç†</h2>
<div class="success-message" id="success-message"></div>
<div class="error-message" id="error-message"></div>

<div class="button-group">
<button class="btn-primary" onclick="showAddForm()">æ–°ã—ã„å•é¡Œã‚’è¿½åŠ </button>
</div>

<div id="add-edit-form" style="display: none; margin-top: 20px;">
<h3 id="form-title">æ–°ã—ã„å•é¡Œã‚’è¿½åŠ </h3>
<div class="form-group">
<label for="question-input">å•é¡Œæ–‡ï¼š</label>
<textarea id="question-input" placeholder="å•é¡Œæ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
</div>

<div class="form-group">
<label>é¸æŠè‚¢ï¼š</label>
<div class="option-group">
<input type="text" id="option-0" placeholder="é¸æŠè‚¢ A" />
<label><input type="radio" name="correct-answer" value="0" /> æ­£è§£</label>
</div>
<div class="option-group">
<input type="text" id="option-1" placeholder="é¸æŠè‚¢ B" />
<label><input type="radio" name="correct-answer" value="1" /> æ­£è§£</label>
</div>
<div class="option-group">
<input type="text" id="option-2" placeholder="é¸æŠè‚¢ C" />
<label><input type="radio" name="correct-answer" value="2" /> æ­£è§£</label>
</div>
</div>

<div class="button-group">
<button class="btn-primary" id="save-btn" onclick="saveQuestion()">ä¿å­˜</button>
<button class="btn-secondary" onclick="cancelEdit()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
</div>
</div>

<h3>ç™»éŒ²æ¸ˆã¿ã®å•é¡Œ</h3>
<div id="questions-list"></div>
</div>
</div>

<!-- éŸ³å£°è¨­å®šã‚¿ãƒ– -->
<div class="tab-content" id="voice-settings">
<div class="quiz-container">
<h2>ğŸ¤ éŸ³å£°è¨­å®š</h2>
<div class="success-message" id="success-message-voice"></div>

<div class="voice-settings">
<label for="voice-lang">è¨€èªã‚’é¸æŠï¼š</label>
<select id="voice-lang" onchange="updateVoiceLang()">
<option value="en-US">è‹±èªï¼ˆã‚¢ãƒ¡ãƒªã‚«ï¼‰- æ¨å¥¨</option>
<option value="en-GB">è‹±èªï¼ˆã‚¤ã‚®ãƒªã‚¹ï¼‰</option>
<option value="en-AU">è‹±èªï¼ˆã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢ï¼‰</option>
<option value="ja-JP">æ—¥æœ¬èª</option>
</select>
</div>

<div class="voice-settings">
<label for="voice-rate">è©±é€Ÿï¼š</label>
<input type="range" id="voice-rate" min="0.5" max="2" step="0.1" value="0.9" onchange="updateVoiceRate()">
<span id="rate-display">0.9x</span>
</div>

<div class="voice-settings">
<label for="voice-pitch">ãƒ”ãƒƒãƒï¼š</label>
<input type="range" id="voice-pitch" min="0.5" max="2" step="0.1" value="1.1" onchange="updateVoicePitch()">
<span id="pitch-display">1.1</span>
</div>

<div class="button-group">
<button class="btn-primary" onclick="testVoice()">éŸ³å£°ãƒ†ã‚¹ãƒˆ</button>
<button class="btn-secondary" onclick="resetVoiceSettings()">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™</button>
</div>

<div style="margin-top: 20px; padding: 15px; background-color: #e9f0ff; border-radius: 8px;">
<h3>ğŸ“ ä½¿ã„æ–¹</h3>
<ul>
<li>âœ… ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯æµæš¢ãªè‹±èªç™ºéŸ³ï¼ˆã‚¢ãƒ¡ãƒªã‚«è‹±èªï¼‰ã«æœ€é©åŒ–ã•ã‚Œã¦ã„ã¾ã™</li>
<li>ğŸ¤ ã€Œã‚¯ã‚¤ã‚ºã€ã‚¿ãƒ–ã§å•é¡Œã® ğŸ”Š ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€è‡ªå‹•åˆ¤åˆ¥ã§èª­ã¿ä¸Šã’ã¾ã™</li>
<li>ğŸŒ è‹±èªãƒ†ã‚­ã‚¹ãƒˆã¯æµæš¢ãªè‹±èªã§ã€æ—¥æœ¬èªã¯æ—¥æœ¬èªã§èª­ã¿ä¸Šã’</li>
<li>âš™ï¸ è¨€èªã€é€Ÿåº¦ã€ãƒ”ãƒƒãƒã‚’ã“ã“ã§è‡ªç”±ã«èª¿æ•´ã§ãã¾ã™</li>
<li>ğŸ’¾ è¨­å®šã¯è‡ªå‹•çš„ã«ä¿å­˜ã•ã‚Œã¾ã™</li>
</ul>
</div>
</div>
</div>

<!-- è¨­å®šã‚¿ãƒ– -->
<div class="tab-content" id="settings">
<div class="quiz-container">
<h2>ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†</h2>
<div class="success-message" id="success-message-settings"></div>
<div class="error-message" id="error-message-settings"></div>

<div class="form-group">
<label>å•é¡Œãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼š</label>
<button class="btn-primary" onclick="exportData()">JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
</div>

<div class="form-group">
<label>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†ï¼š</label>
<button class="btn-primary" onclick="forceClearAndReloadExternal()" style="background-color: #ff9800;">ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ï¼†å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¼·åˆ¶èª­ã¿è¾¼ã¿</button>
</div>

<div class="form-group">
<label>ç«¯æœ«åˆ¥ã«ä¿å­˜ï¼š</label>
<button class="btn-primary" onclick="saveAsDevice('pc')">ä¿å­˜ï¼ˆPCï¼‰</button>
<button class="btn-primary" onclick="saveAsDevice('mobile')">ä¿å­˜ï¼ˆã‚¹ãƒãƒ›ï¼‰</button>
<div id="last-saved-info" style="margin-top:8px;color:#333;">æœ€çµ‚ä¿å­˜: ãªã—</div>
</div>

<div class="form-group">
<label>å•é¡Œãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼š</label>
<input type="file" id="import-file" accept=".json" />
<button class="btn-primary" onclick="importData()">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
</div>

<div class="form-group">
<button class="btn-danger" onclick="resetData()">ã™ã¹ã¦ãƒªã‚»ãƒƒãƒˆï¼ˆåˆæœŸçŠ¶æ…‹ã«æˆ»ã™ï¼‰</button>
</div>
</div>
</div>
</div>

<script>
// ========================================================================
// TOEIC L495 ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° - éŸ³å£°æ©Ÿèƒ½ä»˜ãæ”¹è¨‚ç‰ˆ
// ========================================================================

// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å•é¡Œãƒ‡ãƒ¼ã‚¿
// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å•é¡Œãƒ‡ãƒ¼ã‚¿ï¼ˆquiz data.js ã‹ã‚‰èª­ã¿è¾¼ã¾ã‚Œã‚‹ externalQuizData ã‚’ã‚³ãƒ”ãƒ¼ï¼‰
let defaultQuizData = [];

// åˆæœŸåŒ–æ™‚ã« quiz data.js ã‹ã‚‰èª­ã¿è¾¼ã‚“ã  externalQuizData ã‚’ä½¿ç”¨
// æ–‡å­—åˆ—ãƒãƒƒã‚·ãƒ¥ï¼ˆç°¡æ˜“ï¼‰
function computeHash(str) {
	let hash = 5381;
	for (let i = 0; i < str.length; i++) {
		hash = ((hash << 5) + hash) + str.charCodeAt(i); /* hash * 33 + c */
		hash = hash & 0xFFFFFFFF;
	}
	return hash.toString();
}

function initializeDefaultData() {
	if (typeof externalQuizData !== 'undefined' && Array.isArray(externalQuizData)) {
		defaultQuizData = [...externalQuizData];
	} else {
		// ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: externalQuizData ãŒèª­ã¿è¾¼ã¾ã‚Œãªã„å ´åˆã¯ç©ºé…åˆ—ã«ã—ã¾ã™ã€‚
		// å®Ÿéš›ã®å•é¡Œã¯ `quiz-data.js` ã«å®šç¾©ã—ã¦ãã ã•ã„ã€‚
		defaultQuizData = [];
	}
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
let quizData = [];
let currentQuestionIndex = 0;
let editingIndex = -1;
let isSpeaking = false;

// ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒç”¨å¤‰æ•°
let stopwatchRunning = false;
let stopwatchSeconds = 0;
let stopwatchInterval = null;
const TARGET_SECONDS_PER_QUESTION = 95; // 1åˆ†35ç§’ (å®Ÿéš›ã®TOEIC L495ç›¸å½“)

// ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼
const STORAGE_KEY = 'toeic_quiz_data';
const VOICE_SETTINGS_KEY = 'toeic_voice_settings';

// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéŸ³å£°è¨­å®š
let voiceSettings = {
lang: 'en-US',
rate: 0.9,
pitch: 1.1
};

// ========================================================================
// åˆæœŸåŒ–ã¨åŸºæœ¬æ©Ÿèƒ½
// ========================================================================

window.onload = function() {
loadVoiceSettings();
loadQuizData();
loadQuestion();
renderQuestionsList();
updateLastSavedUI();
};

function loadQuizData() {
// å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ defaultQuizData ã‚’åˆæœŸåŒ–
initializeDefaultData();
	// compute external data hash to detect updates in quiz data.js
	const extHash = computeHash(JSON.stringify(defaultQuizData));
	const prevExtHash = localStorage.getItem('toeic_external_hash');

	const stored = localStorage.getItem(STORAGE_KEY);
	if (stored) {
		try {
			// if external data changed since last time, ask user whether to replace local data
			if (prevExtHash && prevExtHash !== extHash) {
				const keep = confirm('å¤–éƒ¨ã® quiz-data.js ãŒæ›´æ–°ã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹å•é¡Œã‚’å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã§ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ\n[OK] ä¸Šæ›¸ãã™ã‚‹ï¼ˆå¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚’æ¡ç”¨ï¼‰\n[ã‚­ãƒ£ãƒ³ã‚»ãƒ«] ç¾åœ¨ã®ãƒ–ãƒ©ã‚¦ã‚¶ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ');
				if (keep) {
					quizData = [...defaultQuizData];
					saveQuizData();
					localStorage.setItem('toeic_external_hash', extHash);
				} else {
					quizData = JSON.parse(stored);
				}
			} else {
				quizData = JSON.parse(stored);
				// if no previous hash stored, set it now
				if (!prevExtHash) localStorage.setItem('toeic_external_hash', extHash);
			}
		} catch (e) {
			console.error('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', e);
			quizData = [...defaultQuizData];
			saveQuizData();
			localStorage.setItem('toeic_external_hash', extHash);
		}
	} else {
		quizData = [...defaultQuizData];
		saveQuizData();
		localStorage.setItem('toeic_external_hash', extHash);
	}
}

function saveQuizData() {
localStorage.setItem(STORAGE_KEY, JSON.stringify(quizData));
}

function loadVoiceSettings() {
const stored = localStorage.getItem(VOICE_SETTINGS_KEY);
if (stored) {
try {
voiceSettings = JSON.parse(stored);
} catch (e) {
console.error('éŸ³å£°è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', e);
}
}
updateVoiceSettingsUI();
}

function saveVoiceSettings() {
localStorage.setItem(VOICE_SETTINGS_KEY, JSON.stringify(voiceSettings));
}

function updateVoiceSettingsUI() {
document.getElementById('voice-lang').value = voiceSettings.lang;
document.getElementById('voice-rate').value = voiceSettings.rate;
document.getElementById('voice-pitch').value = voiceSettings.pitch;
document.getElementById('rate-display').textContent = voiceSettings.rate.toFixed(1) + 'x';
document.getElementById('pitch-display').textContent = voiceSettings.pitch.toFixed(1);
}

// ========================================================================
// éŸ³å£°æ©Ÿèƒ½
// ========================================================================

function speak(text) {
if (isSpeaking) {
window.speechSynthesis.cancel();
isSpeaking = false;
return;
}

const utterance = new SpeechSynthesisUtterance(text);

// ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰è¨€èªã‚’è‡ªå‹•åˆ¤åˆ¥
let detectedLang = voiceSettings.lang;
const hasEnglish = /[a-zA-Z]/.test(text);
const hasJapanese = /[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FFF]/.test(text);

if (hasEnglish && !hasJapanese) {
// è‹±èªã®ã¿ã®å ´åˆã¯è‹±èªã§èª­ã¿ä¸Šã’
detectedLang = 'en-US';
utterance.rate = 0.9;  // æµæš¢ãªè‹±èªé€Ÿåº¦
utterance.pitch = 1.1; // è‡ªç„¶ãªãƒ”ãƒƒãƒ
} else if (hasJapanese && !hasEnglish) {
// æ—¥æœ¬èªã®ã¿ã®å ´åˆã¯æ—¥æœ¬èªã§èª­ã¿ä¸Šã’
detectedLang = 'ja-JP';
utterance.rate = 1.0;
utterance.pitch = 1.0;
} else {
// æ··åˆãƒ†ã‚­ã‚¹ãƒˆã®å ´åˆã¯è¨­å®šè¨€èªã‚’ä½¿ç”¨
utterance.rate = voiceSettings.rate;
utterance.pitch = voiceSettings.pitch;
}

utterance.lang = detectedLang;

utterance.onstart = function() {
isSpeaking = true;
updateButtonStates();
};

utterance.onend = function() {
isSpeaking = false;
updateButtonStates();
};

utterance.onerror = function(event) {
console.error('éŸ³å£°å†ç”Ÿã‚¨ãƒ©ãƒ¼:', event);
isSpeaking = false;
updateButtonStates();
};

window.speechSynthesis.speak(utterance);
}

function updateButtonStates() {
const questionBtn = document.getElementById('question-voice-btn');
if (questionBtn) {
if (isSpeaking) {
questionBtn.classList.add('playing');
questionBtn.textContent = 'â¹ï¸';
} else {
questionBtn.classList.remove('playing');
questionBtn.textContent = 'ğŸ”Š';
}
}
}

function speakQuestion() {
if (quizData.length === 0) return;
const currentQuiz = quizData[currentQuestionIndex];
const cleanQuestion = currentQuiz.question
.replace(/<[^>]*>/g, '')
.replace(/\*\*/g, '')
.replace(/&nbsp;/g, ' ')
.replace(/&lt;/g, '<')
.replace(/&gt;/g, '>')
.replace(/&quot;/g, '"')
.replace(/&#39;/g, "'");
speak(cleanQuestion);
}

function speakOption(index) {
if (quizData.length === 0) return;
const currentQuiz = quizData[currentQuestionIndex];
if (index < currentQuiz.options.length) {
speak(currentQuiz.options[index]);
}
}

function testVoice() {
const lang = document.getElementById('voice-lang').value;
const testText = lang.includes('ja') ? 'ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆã§ã™' : 'This is a test';
speak(testText);
showMessage('success', 'ãƒ†ã‚¹ãƒˆéŸ³å£°ã‚’å†ç”Ÿã—ã¦ã„ã¾ã™...', 'voice');
}

function updateVoiceLang() {
voiceSettings.lang = document.getElementById('voice-lang').value;
saveVoiceSettings();
}

function updateVoiceRate() {
const rate = parseFloat(document.getElementById('voice-rate').value);
voiceSettings.rate = rate;
document.getElementById('rate-display').textContent = rate.toFixed(1) + 'x';
saveVoiceSettings();
}

function updateVoicePitch() {
const pitch = parseFloat(document.getElementById('voice-pitch').value);
voiceSettings.pitch = pitch;
document.getElementById('pitch-display').textContent = pitch.toFixed(1);
saveVoiceSettings();
}

function resetVoiceSettings() {
voiceSettings = {
lang: 'en-US',
rate: 0.9,
pitch: 1.1
};
saveVoiceSettings();
updateVoiceSettingsUI();
showMessage('success', 'éŸ³å£°è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸï¼ˆæµæš¢ãªè‹±èªç™ºéŸ³ï¼‰', 'voice');
}

// ========================================================================
// ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
// ========================================================================

function switchTab(tabName) {
document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));

document.getElementById(tabName).classList.add('active');
event.target.classList.add('active');

if (tabName === 'edit') {
renderQuestionsList();
}
}

// ========================================================================
// ã‚¯ã‚¤ã‚ºè¡¨ç¤ºæ©Ÿèƒ½
// ========================================================================

function loadQuestion() {
if (quizData.length === 0) {
document.getElementById('question-text').textContent = 'å•é¡ŒãŒã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã€Œå•é¡Œã®ç®¡ç†ã€ã‚¿ãƒ–ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„ã€‚';
document.getElementById('options').innerHTML = '';
document.getElementById('next-button').style.display = 'none';
document.getElementById('feedback').style.display = 'none';
document.getElementById('question-voice-btn').style.display = 'none';
document.getElementById('hint-box').style.display = 'none';
document.getElementById('hint-btn').style.display = 'none';
return;
}

if (currentQuestionIndex >= quizData.length) {
document.getElementById('question-text').textContent = `å…¨${quizData.length}å•å®Œäº†ï¼ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚`;
document.getElementById('options').innerHTML = '';
document.getElementById('next-button').style.display = 'none';
document.getElementById('feedback').style.display = 'none';
document.getElementById('question-voice-btn').style.display = 'none';
document.getElementById('hint-box').style.display = 'none';
document.getElementById('hint-btn').style.display = 'none';
return;
}

const currentQuiz = quizData[currentQuestionIndex];
document.getElementById('question-text').textContent = currentQuiz.question;
document.getElementById('next-button').textContent = `æ¬¡ã®å•é¡Œã¸ (${currentQuestionIndex + 1}/${quizData.length})`;

const optionsDiv = document.getElementById('options');
optionsDiv.innerHTML = '';
for (let i = 0; i < currentQuiz.options.length; i++) {
const optionItem = document.createElement('div');
optionItem.className = 'option-item';
optionItem.innerHTML = `
<button onclick="checkAnswer(${i})">${currentQuiz.options[i]}</button>
<button class="voice-button voice-button-small" onclick="speakOption(${i})" title="é¸æŠè‚¢ã‚’èª­ã¿ä¸Šã’ã¾ã™">ğŸ”Š</button>
`;
optionsDiv.appendChild(optionItem);
}

document.getElementById('next-button').style.display = 'none';
document.getElementById('feedback').style.display = 'none';
document.getElementById('hint-box').style.display = 'none';
document.getElementById('question-voice-btn').style.display = 'block';
document.getElementById('hint-btn').style.display = 'block';
}

function checkAnswer(selectedIndex) {
const currentQuiz = quizData[currentQuestionIndex];
const feedbackDiv = document.getElementById('feedback');
const optionButtons = document.querySelectorAll('.option-item button:first-child');

for (let btn of optionButtons) {
btn.disabled = true;
}

if (selectedIndex === currentQuiz.answerIndex) {
feedbackDiv.textContent = 'æ­£è§£ï¼ãã®æ©Ÿèƒ½è¡¨ç¾ã®æ„å‘³ã‚’ã—ã£ã‹ã‚Šã¨ç†è§£ã§ãã¦ã„ã¾ã™ã€‚';
feedbackDiv.className = 'feedback correct';
optionButtons[selectedIndex].classList.add('correct');
} else {
const correctOptionText = currentQuiz.options[currentQuiz.answerIndex];
const correctAnswerLabel = String.fromCharCode(65 + currentQuiz.answerIndex); // A, B, C
feedbackDiv.innerHTML = `ä¸æ­£è§£ã€‚ã“ã®è¡¨ç¾ãŒæš—ç¤ºã™ã‚‹æ„å›³ã‚’å†ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚<br><br><strong>æ­£è§£: ${correctAnswerLabel}) ${correctOptionText}</strong>`;
feedbackDiv.className = 'feedback incorrect';
optionButtons[selectedIndex].classList.add('incorrect');
optionButtons[currentQuiz.answerIndex].classList.add('correct');
}

feedbackDiv.style.display = 'block';
document.getElementById('next-button').style.display = 'block';
}

function loadNextQuestion() {
currentQuestionIndex++;
updateStopwatchDisplay(); // ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒè¡¨ç¤ºã‚’æ›´æ–°
loadQuestion();
}

function showHint() {
if (quizData.length === 0 || currentQuestionIndex >= quizData.length) return;
const currentQuiz = quizData[currentQuestionIndex];
const hintBox = document.getElementById('hint-box');
const hintText = document.getElementById('hint-text');

if (currentQuiz.hint) {
hintText.textContent = currentQuiz.hint;
hintBox.style.display = 'block';
} else {
hintText.textContent = 'ãƒ’ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚';
hintBox.style.display = 'block';
}
}

// ========================================================================
// ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒæ©Ÿèƒ½
// ========================================================================

function toggleStopwatch() {
if (stopwatchRunning) {
stopwatchRunning = false;
clearInterval(stopwatchInterval);
document.getElementById('stopwatch-btn').textContent = 'â–¶ï¸ å†é–‹';
} else {
stopwatchRunning = true;
document.getElementById('stopwatch-btn').textContent = 'â¸ï¸ ä¸€æ™‚åœæ­¢';
stopwatchInterval = setInterval(updateStopwatch, 1000);
}
}

function updateStopwatch() {
stopwatchSeconds++;
updateStopwatchDisplay();
}

function resetStopwatch() {
stopwatchRunning = false;
stopwatchSeconds = 0;
clearInterval(stopwatchInterval);
document.getElementById('stopwatch-btn').textContent = 'â–¶ï¸ é–‹å§‹';
updateStopwatchDisplay();
}

function updateStopwatchDisplay() {
const minutes = Math.floor(stopwatchSeconds / 60);
const seconds = stopwatchSeconds % 60;
document.getElementById('stopwatch-time').textContent = 
`${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

// ç›®æ¨™æ™‚é–“ã‚’è¨ˆç®—ï¼ˆå•é¡Œæ•° Ã— 1å•ã‚ãŸã‚Šæ™‚é–“ï¼‰
const totalQuestions = quizData.length;
const targetTotalSeconds = totalQuestions * TARGET_SECONDS_PER_QUESTION;
document.getElementById('total-questions').textContent = totalQuestions;
document.getElementById('elapsed-questions').textContent = currentQuestionIndex + 1;

// ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ™‚é–“è¡¨ç¤º
const targetMin = Math.floor(targetTotalSeconds / 60);
const targetSec = targetTotalSeconds % 60;
document.getElementById('target-time').textContent = 
`${targetMin}:${targetSec.toString().padStart(2, '0')}`;

// ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ›´æ–°
const progressPercent = Math.min(100, (stopwatchSeconds / targetTotalSeconds) * 100);
document.getElementById('progress-bar').style.width = progressPercent + '%';

// æ™‚é–“è¶…éæ™‚ã®è‰²å¤‰æ›´
if (stopwatchSeconds > targetTotalSeconds) {
document.getElementById('progress-bar').style.backgroundColor = '#ff6b6b';
} else if (stopwatchSeconds > targetTotalSeconds * 0.8) {
document.getElementById('progress-bar').style.backgroundColor = '#ffc107';
} else {
document.getElementById('progress-bar').style.backgroundColor = '#28a745';
}
}

// ========================================================================
// å•é¡Œã®è¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤æ©Ÿèƒ½
// ========================================================================

function showAddForm() {
editingIndex = -1;
document.getElementById('form-title').textContent = 'æ–°ã—ã„å•é¡Œã‚’è¿½åŠ ';
document.getElementById('question-input').value = '';
document.getElementById('option-0').value = '';
document.getElementById('option-1').value = '';
document.getElementById('option-2').value = '';
document.querySelectorAll('input[name="correct-answer"]').forEach(el => el.checked = false);
document.getElementById('save-btn').textContent = 'è¿½åŠ ';
document.getElementById('add-edit-form').style.display = 'block';
}

function showEditForm(index) {
editingIndex = index;
const quiz = quizData[index];
document.getElementById('form-title').textContent = 'å•é¡Œã‚’ç·¨é›†';
document.getElementById('question-input').value = quiz.question;
document.getElementById('option-0').value = quiz.options[0];
document.getElementById('option-1').value = quiz.options[1];
document.getElementById('option-2').value = quiz.options[2];
document.querySelectorAll('input[name="correct-answer"]').forEach(el => el.checked = false);
document.querySelector(`input[name="correct-answer"][value="${quiz.answerIndex}"]`).checked = true;
document.getElementById('save-btn').textContent = 'æ›´æ–°';
document.getElementById('add-edit-form').style.display = 'block';
}

function saveQuestion() {
const question = document.getElementById('question-input').value.trim();
const option0 = document.getElementById('option-0').value.trim();
const option1 = document.getElementById('option-1').value.trim();
const option2 = document.getElementById('option-2').value.trim();
const answerRadio = document.querySelector('input[name="correct-answer"]:checked');

if (!question) {
showMessage('error', 'å•é¡Œæ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'edit');
return;
}
if (!option0 || !option1 || !option2) {
showMessage('error', 'ã™ã¹ã¦ã®é¸æŠè‚¢ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'edit');
return;
}
if (!answerRadio) {
showMessage('error', 'æ­£è§£ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚', 'edit');
return;
}

const newQuiz = {
question: question,
options: [option0, option1, option2],
answerIndex: parseInt(answerRadio.value)
};

if (editingIndex === -1) {
quizData.push(newQuiz);
showMessage('success', 'å•é¡Œã‚’è¿½åŠ ã—ã¾ã—ãŸï¼', 'edit');
} else {
quizData[editingIndex] = newQuiz;
showMessage('success', 'å•é¡Œã‚’æ›´æ–°ã—ã¾ã—ãŸï¼', 'edit');
}

saveQuizData();
cancelEdit();
renderQuestionsList();
loadQuestion();
}

function cancelEdit() {
document.getElementById('add-edit-form').style.display = 'none';
editingIndex = -1;
}

function deleteQuestion(index) {
if (confirm('ã“ã®å•é¡Œã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
quizData.splice(index, 1);
saveQuizData();
renderQuestionsList();
showMessage('success', 'å•é¡Œã‚’å‰Šé™¤ã—ã¾ã—ãŸï¼', 'edit');

if (currentQuestionIndex >= quizData.length) {
currentQuestionIndex = Math.max(0, quizData.length - 1);
}
loadQuestion();
}
}

// ========================================================================
// å•é¡Œä¸€è¦§ã®è¡¨ç¤º
// ========================================================================

function renderQuestionsList() {
const listDiv = document.getElementById('questions-list');
listDiv.innerHTML = '';

if (quizData.length === 0) {
listDiv.innerHTML = '<p style="color: #999;">å•é¡ŒãŒã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>';
return;
}

quizData.forEach((quiz, index) => {
const item = document.createElement('div');
item.className = 'question-item';
item.innerHTML = `
<div class="question-item-text">${index + 1}. ${quiz.question.substring(0, 50)}...</div>
<div class="question-item-options">
<strong>é¸æŠè‚¢:</strong> A) ${quiz.options[0]} / B) ${quiz.options[1]} / C) ${quiz.options[2]}<br>
<strong>æ­£è§£:</strong> ${String.fromCharCode(65 + quiz.answerIndex)}) ${quiz.options[quiz.answerIndex]}
</div>
<div class="question-item-actions">
<button class="btn-edit" onclick="showEditForm(${index})">ç·¨é›†</button>
<button class="btn-delete" onclick="deleteQuestion(${index})">å‰Šé™¤</button>
</div>
`;
listDiv.appendChild(item);
});
}

// ========================================================================
// ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
// ========================================================================

function exportData(filename = null, showMsg = true) {
const dataStr = JSON.stringify(quizData, null, 2);
const dataBlob = new Blob([dataStr], { type: 'application/json' });
const url = URL.createObjectURL(dataBlob);
const link = document.createElement('a');
link.href = url;
const defaultName = `toeic_quiz_${new Date().toISOString().split('T')[0]}.json`;
link.download = filename || defaultName;
link.click();
URL.revokeObjectURL(url);
if (showMsg) showMessage('success', 'ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸï¼', 'settings');
}

// ç«¯æœ«åˆ¥ã«ä¿å­˜ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼‹ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼‰
function saveAsDevice(device) {
// device: 'pc' or 'mobile'
saveQuizData();
const now = new Date().toISOString();
const meta = { device: device, time: now, count: quizData.length };
localStorage.setItem('toeic_last_saved', JSON.stringify(meta));
updateLastSavedUI();
// ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ä½œæˆ
const safeTime = now.replace(/:/g, '').replace(/\./g, '-');
const filename = `toeic_quiz_${device}_${safeTime}.json`;
exportData(filename, false);
showMessage('success', `ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ˆ${device}ï¼‰ã€‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚`, 'settings');
}

function updateLastSavedUI() {
const container = document.getElementById('last-saved-info');
if (!container) return;
const raw = localStorage.getItem('toeic_last_saved');
if (!raw) {
container.textContent = 'æœ€çµ‚ä¿å­˜: ãªã—';
return;
}
try {
const meta = JSON.parse(raw);
const deviceLabel = meta.device === 'pc' ? 'PC' : 'ã‚¹ãƒãƒ›';
container.textContent = `æœ€çµ‚ä¿å­˜: ${deviceLabel} - ${formatTimestamp(meta.time)} (å•é¡Œæ•°: ${meta.count})`;
} catch (e) {
container.textContent = 'æœ€çµ‚ä¿å­˜: ä¸æ˜';
}
}

function formatTimestamp(iso) {
try {
const d = new Date(iso);
return `${d.getFullYear()}-${(d.getMonth()+1).toString().padStart(2,'0')}-${d.getDate().toString().padStart(2,'0')} ${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}`;
} catch (e) {
return iso;
}
}

function importData() {
const fileInput = document.getElementById('import-file');
if (!fileInput.files.length) {
showMessage('error', 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚', 'settings');
return;
}

const file = fileInput.files[0];
const reader = new FileReader();

reader.onload = function(e) {
try {
const imported = JSON.parse(e.target.result);
if (Array.isArray(imported) && imported.every(item => item.question && item.options && typeof item.answerIndex === 'number')) {
quizData = imported;
saveQuizData();
showMessage('success', 'ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸï¼', 'settings');
renderQuestionsList();
loadQuestion();
fileInput.value = '';
} else {
showMessage('error', 'ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚', 'settings');
}
} catch (error) {
showMessage('error', 'ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚', 'settings');
}
};

reader.readAsText(file);
}

function resetData() {
	if (confirm('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ã€å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆquiz-data.jsï¼‰ã®åˆæœŸçŠ¶æ…‹ã«æˆ»ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
initializeDefaultData();
quizData = [...defaultQuizData];
saveQuizData();
currentQuestionIndex = 0;
	showMessage('success', 'ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸï¼ˆquiz-data.js ã‹ã‚‰èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸï¼‰ï¼', 'settings');
renderQuestionsList();
loadQuestion();
}
}

// ========================================================================
// ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
// ========================================================================

// ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¦å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¼·åˆ¶èª­ã¿è¾¼ã¿
function forceClearAndReloadExternal() {
	localStorage.removeItem(STORAGE_KEY);
	localStorage.removeItem('toeic_external_hash');
	initializeDefaultData();
	quizData = [...defaultQuizData];
	saveQuizData();
	const extHash = computeHash(JSON.stringify(defaultQuizData));
	localStorage.setItem('toeic_external_hash', extHash);
	currentQuestionIndex = 0;
	renderQuestionsList();
	loadQuestion();
	showMessage('success', `ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸï¼å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆquiz-data.jsï¼‰ã‹ã‚‰${quizData.length}å•ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚`, 'settings');
}

function showMessage(type, message, tab) {
const elementId = tab === 'settings' ? `${type}-message-settings` : tab === 'voice' ? `${type}-message-voice` : `${type}-message`;
const element = document.getElementById(elementId);
if (element) {
element.textContent = message;
element.style.display = 'block';

setTimeout(() => {
element.style.display = 'none';
}, 3000);
}
}
</script>

</body>
</html>
